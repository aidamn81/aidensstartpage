// REPLACE your current save logic with this:
document.getElementById('r-save').onclick = async () => {
    const name = document.getElementById('r-name').value;
    const url = document.getElementById('r-url').value;
    const file = document.getElementById('r-file').files[0];
    
    if(!name || !url) return alert("The Archive requires a name and path.");

    let imgData = "";

    // If there is a file, we convert it to a string instead of uploading to Storage
    if(file) {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = async () => {
            imgData = reader.result;
            await saveToFirestore(name, url, imgData);
        };
    } else {
        await saveToFirestore(name, url, "");
    }
};

async function saveToFirestore(name, url, imgData) {
    await db.collection("relics").add({
        name, 
        url, 
        imgUrl: imgData, // This is now the actual image data string
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
    });
    location.reload();
}
